<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<title>ヘルプ - 音程練習アプリ</title>
	<style>
		:root { color-scheme: dark; }
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 20px; line-height: 1.7; color:#e6eaf2; background:#0e0f12; }
		main { max-width: 980px; margin: 0 auto; }
		h1 { margin: 0 0 12px; font-size: 28px; }
		h2 { margin: 18px 0 8px; font-size: 20px; color:#9db4d9; }
		h3 { margin: 14px 0 8px; font-size: 16px; color:#b9c9e6; }
		p, li { font-size: 15px; }
		code, kbd { background:#1c1f26; border:1px solid #2b3245; padding:0 4px; border-radius:4px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
		.tip { background:#121621; border:1px solid #2b3245; padding:10px 12px; border-radius:8px; }
		.caption { font-size:12px; opacity:0.8; }
		a { color:#7ab8ff; }
	</style>
	<link rel="stylesheet" href="styles.css?v=20250920-1">
	<meta http-equiv="Cache-Control" content="no-store" />
	<meta name="description" content="音程練習アプリのヘルプ。音程モード、マイク設定、描画仕様、採点、保存・読み込み、トラブルシュートなど。">
	<meta name="robots" content="noindex">
  
	</head>
<body>
<main>
	<h1>ヘルプ（音程練習アプリ）</h1>
	<p>このページでは、アプリの使い方・設定・表示仕様・採点・トラブル対応を最新仕様に合わせて丁寧に解説します。</p>

	<h2>1. アプリの基本</h2>
	<ul>
		<li><b>ガイド（メロディ）に合わせて歌い</b>、<b>マイクのピッチ</b>をリアルタイムで可視化・記録します。</li>
		<li><b>音程モード</b>では、音源を鳴らさず<b>マイクのピッチのみ</b>を表示・記録します（右上に「音程モード」バッジ）。</li>
		<li>表示は<b>キャンバス（グリッド/ノート/再生線/赤点など）</b>で構成されます。停止中は（音程モード以外）履歴グラフを抑制します。</li>
	</ul>

	<h2>2. 音声ファイルの読み込みと抽出</h2>
	<ul>
		<li>メロディ音声を読み込むと、<b>YIN（CMND）ベースの同一エンジン</b>でピッチ抽出を行い、メロディトラックを自動生成します。</li>
		<li>オフライン解析もリアルタイムと<b>同一の YIN モジュール</b>を使用しており、表示・採点の一貫性が保たれます。</li>
		<li>抽出後はトラック編集や移調が可能です。</li>
	</ul>

	<h2>3. マイクの使用</h2>
	<ul>
		<li><b>PC</b>：権限許可後は即使用可能。選択肢が必要な場合はオーバーレイで<b>デバイス選択</b>ができます。</li>
		<li><b>モバイル</b>：許可後に<b>マイク選択オーバーレイ</b>が表示されます。選んだデバイスは次回に保存されます。</li>
		<li>マイクの信号は<b>HPF/LPF</b>により低域/高域ノイズを軽減し、解析用のアナライザに接続されます（スピーカーへは直結しません）。</li>
		<li>無音や途切れを検知した場合は自動で<b>再初期化</b>し、安定動作を図ります。</li>
	</ul>

	<h2>4. 表示・描画のルール</h2>
	<ul>
		<li><b>ピッチ履歴（赤点/グラフ）</b>は、<b>音程モード時</b>は停止中でも描画します。通常モードでは<b>再生中のみ</b>描画します。</li>
		<li><b>ライブ赤丸</b>は停止中も表示されます（音程モードでは履歴も表示）。必要に応じて将来切替可能。</li>
		<li><b>補正・吸着・オクターブ合わせの視覚効果</b>は撤廃。<b>生のピッチ</b>をそのまま表示します。</li>
		<li>縦スライダーは<b>右側</b>に配置。チャートの<b>縦方向移動は 1:1</b>でドラッグに追従します。</li>
		<li>縦の表示範囲は<b>初期の約2.5オクターブ固定</b>（自動ズームは無効）。必要に応じて手動でオフセットを調整します。</li>
	</ul>

	<h2>5. 編集と移調</h2>
	<ul>
		<li>編集モードでは、<b>再生線の下にあるノートを常に自動選択</b>します。分割/範囲選択/半音・オクターブ移動が可能です。</li>
		<li>左側の<b>＋/－ボタン</b>で<b>メロディ全体</b>を<b>±12 半音</b>移動（クランプあり）。再生中は再スケジュールして追従します。</li>
		<li>キーボード操作：<kbd>ArrowUp</kbd>/<kbd>ArrowDown</kbd> で選択範囲を<b>±12</b>、<kbd>[</kbd>/<kbd>]</kbd> で<b>±1</b>。<kbd>Shift</kbd>併用でフレーズ後続にも適用。</li>
	</ul>

	<h2>6. トランスポート・練習支援</h2>
	<ul>
		<li>再生/停止、追従、メトロノーム、テンポ、マーカー（A～G）を提供。マーキング後はボタン一つでその位置から再生。</li>
		<li><b>練習支援（アシスト）</b>や<b>BT遅延補正</b>（Bluetoothイヤホンの遅延を秒で補正）の設定があります。</li>
		<li>音程モードでは再生は<b>無音</b>になり、マイクの可視化に専念します。</li>
	</ul>

	<h2>7. 採点とオーバーレイ</h2>
	<ul>
		<li>許容範囲（±セント）を中心に、<b>一致時間の割合</b>から基本スコアを算出。大外れ（±50c超）時間は減点カウント。</li>
		<li>安定度・センタリング等でボーナスを加算、上限は 100 点。右上の<b>アドバイス</b>から詳細なフィードバックを開けます。</li>
		<li><kbd>O</kbd> キーで<b>音種（C/D/E…）のオーバーレイ</b>をON/OFFできます。</li>
	</ul>

	<h2>8. 保存/読み込み</h2>
	<ul>
		<li><b>セッション保存</b>では、<b>ノート/赤点/設定</b>と、読み込んだ音声（メロディ/伴奏）を ZIP にまとめます。</li>
		<li><b>読み込み</b>時は同内容を復元。バージョン差異がある場合も可能な範囲で安全にマージします。</li>
	</ul>

	<h2>9. トラブルシュート</h2>
	<h3>マイクの音がすぐ途切れる/検出が不安定</h3>
	<div class="tip">
		<ul>
			<li>通話アプリ（Zoom/Teams/Discord等）を<b>完全終了</b>し、OS の<b>ノイズ抑制/AGC</b>を<b>OFF</b>にしてください。</li>
			<li>Windows: 設定 → サウンド → 入力 → デバイスのプロパティ → 追加のデバイスプロパティ → ノイズ抑制/AGC を OFF。</li>
			<li>macOS: システム設定 → サウンド → 入力 → 環境ノイズ低減を OFF。通話系アプリの処理も OFF。</li>
			<li>iOS: コントロールセンター → マイクモードを「ワイドスペクトル」。</li>
			<li>Android: 端末設定の通話強化/騒音抑制を OFF。Chrome最新版を推奨。</li>
		</ul>
	</div>
	<h3>マイクが使えない</h3>
	<p>ブラウザの制約により、<b>https</b>（または <b>http://localhost</b>）でのアクセスが必要です。権限を許可し、デバイス選択オーバーレイから正しいマイクを選択してください。</p>
	<h3>ピッチが表示されない/遅い</h3>
	<p>解析レート/ゲート/マイク入力レベルを見直してください。外部マイク/オーディオIFで安定性が上がる場合があります。</p>

	<h2>10. よくある質問（FAQ）</h2>
	<ul>
		<li><b>Q.</b> 停止中に履歴グラフが見えません。<br><b>A.</b> 仕様です（音程モード除く）。再生すると表示されます。</li>
		<li><b>Q.</b> 全体を1オクターブ上げたい。<br><b>A.</b> 左側の <b>＋</b>/<b>－</b> ボタンで一括移調できます。</li>
		<li><b>Q.</b> 音名表記を変えたい。<br><b>A.</b> 設定から <b>CDE/ドレ</b> を切替えできます。</li>
	</ul>

	<h2>11. キーボードショートカット</h2>
	<ul>
		<li><kbd>ArrowUp</kbd>/<kbd>ArrowDown</kbd>：選択に ±12（<kbd>Shift</kbd> で後続にも）</li>
		<li><kbd>[</kbd>/<kbd>]</kbd>：選択に ±1</li>
		<li><kbd>O</kbd>：音種オーバーレイの表示切り替え</li>
	</ul>

	<h2>12. 仕様ハイライト（技術メモ）</h2>
	<ul>
		<li>ピッチ検出：YIN（CMND）＋補助（SHS/ビタビ）/平滑化。リアルタイム/オフラインの<b>同一実装</b>。</li>
		<li>描画：停止中の履歴は抑制（音程モード除く）、ライブ赤丸は表示。縦スライダー右配置、縦ドラッグ 1:1。</li>
		<li>ズーム：自動縦ズームは無効、初期約2.5オクターブ固定。手動オフセットで調整。</li>
		<li>全体移調：左側の＋/－で ±12 半音（[36,127] にクランプ）。</li>
	</ul>

	<p class="caption">最終更新: 2025-09-21</p>
</main>
</body>
</html>
<li>対応拡張子：<b>.mid/.midi/.musicxml/.xml</b>（<b>.mxl は次版</b>）。</li>
<li>file:// でも動作しますが、<b>マイクはブラウザ制約で https または http://localhost が必要</b>です。README を参照。</li>
</ul>
<h2>主な設定</h2>
<ul>
<li><b>A4 基準</b>：音名/セント算出の基準周波数。</li>
<li><b>音程の許容範囲（±セント）</b>：採点・ガイド帯の幅。</li>
<li><b>解析レート</b>：高いほど滑らかですが CPU 負荷増。</li>
<li><b>ゲート（dBFS）</b>：この閾値以下の音は無視。</li>
<li><b>縦ズーム/オフセット/ラベル倍率</b>：チャートの見た目調整。</li>
<li><b>移調（半音）</b>：表示・再生・判定すべてに適用。</li>
<li><b>テンポ倍率</b>：0.8～1.2x。メトロノームも追従。</li>
<li><b>オクターブ合わせ</b>：±12 半音の誤認を緩和。</li>
<li><b>鍵盤ハイライト対象</b>：ガイド/マイクどちらを強調。</li>
</ul>
<h2>採点ロジック概要</h2>
<ol>
<li>各フレームの推定ピッチをセントに換算（A4 基準・移調・オクターブ補正を反映）。</li>
<li>メロディのガイドと比較。許容帯内で +1、±50c 超は減点用に別カウント。</li>
<li>時間加重平均で基本点を算出。ボーナス（センタリング・安定度）を加算、最大 100。</li>
<li>終了時レポートに詳細統計（合致率、平均誤差、最大外れ、安定度指標）。</li>
</ol>
<h2>デバッグ</h2>
<p>URL の末尾に <code>#debug</code> を付与するか、UI のトグルでデバッグを表示。ログ/計測/自己診断を確認できます。</p>
</main></body></html>